<!DOCTYPE html>
<style type="text/css">
body,div,ul,li{margin:0;padding:0;}
#box{width:770px;margin:0 auto;padding:10px 0 0 10px;background:#f00;overflow:hidden;zoom:1;}
#box li{float:left;width:375px;height:225px;color:#fff;padding:10px 0;display:inline;text-align:center;margin:0 10px 10px 0;background:#FFFFFF url(http://i.ltimg.cn/letaozu/images/load/ajax-loader.gif) 50% 50% no-repeat;}
</style>



<script src="../HTB_beta.js"></script>

<ul id="box">
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/1.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/2.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/3.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/4.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/5.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/6.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/7.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/8.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/9.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/10.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/11.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/12.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/13.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/14.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/15.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/16.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/17.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/18.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/19.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/20.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/21.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/22.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/23.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/24.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/25.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/26.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/27.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/28.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/29.jpg" /></li>
    <li><img lazy_src="http://js.fgm.cc/learn/lesson10/img/lazy/30.jpg" /></li>
</ul>



<script>
	HTB.widget.lazyLoad = function( oConfig ) {
		this.config = {
			imgTag: oConfig.imgTag
		};
		this.temp = {
			imgs: HTB.Dom.getByTagName( "img" ),
			lazyImg: []
		};
		return this;
	};

	HTB.widget.lazyLoad.prototype = {
		init: function() {
			var _self = this,
				config = this.config,
				temp = this.temp;
			
			_self._initEvent();
			return _self;
		},

		_initEvent: function() {
			var _self = this,
				config = this.config,
				temp = this.temp;

			HTB.Event.addEvent( window, "load", function() {
				_self._lazy();
			} );

			HTB.Event.addEvent( window, "scroll", function() {
				_self._lazy();
			} );

			HTB.Event.addEvent( window, "resize", function() {
				_self._lazy();
			} );
		},

		_lazy: function() {
			var _self = this,
				config = this.config,
				temp = this.temp;

			_self._getImgs();

			var scrollTop = HTB.Dom.getScrollTop(),
				clientHeight = HTB.Dom.getClientHeight();

			for ( var i = 0, len = temp.lazyImg.length; i < temp.lazyImg.length; i++ ) {
				var lazyItem = temp.lazyImg[ i ],
					imgTop = HTB.Dom.getY( lazyItem );
				if ( imgTop > scrollTop && imgTop < scrollTop + clientHeight ) {
					var lazySrc = lazyItem.getAttribute( config.imgTag );
					if ( lazyItem.src != lazySrc ) {
						lazyItem.src = lazySrc;
					}
				}
			}
		},

		_getImgs: function() {
			var _self = this,
				config = this.config,
				temp = this.temp;

			for ( var i = 0, len = temp.imgs.length; i < len; i++ ) {
				var item = temp.imgs[ i ];
				if ( item.getAttribute( config.imgTag ) ) {
					temp.lazyImg.push( item );
				}
			}
		}
	};

	( function() {
		var lazyLoad = new HTB.widget.lazyLoad( {
			imgTag: "lazy_src"
		} );
		lazyLoad.init();
	} )();

</script>
</html>